<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="/socket.io/socket.io.js"></script>
</head>
<body>
  <div class="loader-overlay" id="loader">
    <div class="loader"></div>
  </div>

  <div class="container">
    <div class="header">
      <h1>üìä ‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö</h1>
      <p>‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏¢‡πâ‡∏≠‡∏°‡∏ß‡∏±‡∏î‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ï‡∏£‡∏ô‡πâ‡∏≥</p>
      <div class="access-info" id="access-info" style="display:none;">
        <div><strong>‡πÄ‡∏õ‡∏¥‡∏î‡∏ö‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á:</strong> <span id="access-local"></span></div>
        <div><strong>‡πÅ‡∏ä‡∏£‡πå‡∏ú‡πà‡∏≤‡∏ô Wi‚ÄëFi:</strong> <span id="access-lan">-</span></div>
        <div class="access-note">‡∏õ‡∏£‡∏±‡∏ö‡∏ó‡∏µ‡πà‡πÑ‡∏ü‡∏•‡πå <code>config.json</code> ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏û‡∏≠‡∏£‡πå‡∏ï‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ö‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢</div>
      </div>
    </div>

    <div class="main-content">
      <div class="nav-tabs">
        <button class="nav-tab active" data-tab="add-record">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
        <button class="nav-tab" data-tab="records-list">üìã ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö</button>
        <button class="nav-tab" data-tab="machine-history">üîç ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á</button>
        <button class="nav-tab" data-tab="summary">üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°</button>
      </div>

      <div class="tab-content active" id="add-record">
        <div class="form-section">
          <h2 style="margin-bottom:14px;">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÉ‡∏´‡∏°‡πà</h2>
          <div class="form-group">
            <label for="machine-select">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏¢‡πâ‡∏≠‡∏°:</label>
            <select id="machine-select"></select>
          </div>
          <div class="form-group">
            <label for="calibrator-select">‡∏ú‡∏π‡πâ‡∏™‡∏≠‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö:</label>
            <select id="calibrator-select">
              <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡∏™‡∏≠‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö --</option>
              <option value="‡∏à‡∏±‡∏Å‡∏£‡∏Å‡∏§‡∏©‡∏ì‡πå">‡∏à‡∏±‡∏Å‡∏£‡∏Å‡∏§‡∏©‡∏ì‡πå</option>
              <option value="‡∏≠‡∏≤‡∏ô‡∏ô‡∏ó‡πå">‡∏≠‡∏≤‡∏ô‡∏ô‡∏ó‡πå</option>
              <option value="‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå">‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå</option>
            </select>
          </div>
          <div class="form-group">
            <label for="calibration-date">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö:</label>
            <input type="date" id="calibration-date">
          </div>
          <div class="form-group">
            <label>‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö:</label>
            <div class="status-buttons">
              <div class="status-btn pass" data-status="pass">‚úÖ ‡∏ú‡πà‡∏≤‡∏ô</div>
              <div class="status-btn fail" data-status="fail">‚ùå ‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô</div>
            </div>
          </div>
          <div class="form-group">
            <label for="notes">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ):</label>
            <textarea id="notes" rows="3" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°..."></textarea>
          </div>
          <div class="form-group">
            <label for="image-upload">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û:</label>
            <input type="file" id="image-upload" accept="image/*">
          </div>
          <button class="submit-btn" id="add-record-btn">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
        </div>
      </div>

      <div class="tab-content" id="records-list">
        <h2 style="margin-bottom:10px;">üìã ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö</h2>
        <div class="filters">
            <div class="form-group">
                <label for="filter-search">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á:</label>
                <input type="text" id="filter-search" placeholder="‡πÄ‡∏ä‡πà‡∏ô DD50-1...">
            </div>
            <div class="form-group">
                <label for="filter-status">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</label>
                <select id="filter-status">
                    <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                    <option value="pass">‡∏ú‡πà‡∏≤‡∏ô</option>
                    <option value="fail">‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô</option>
                </select>
            </div>
            <div class="form-group">
                <label for="filter-calibrator">‡∏ú‡∏π‡πâ‡∏™‡∏≠‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö:</label>
                <select id="filter-calibrator">
                    <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                     <option value="‡∏à‡∏±‡∏Å‡∏£‡∏Å‡∏§‡∏©‡∏ì‡πå">‡∏à‡∏±‡∏Å‡∏£‡∏Å‡∏§‡∏©‡∏ì‡πå</option>
                     <option value="‡∏≠‡∏≤‡∏ô‡∏ô‡∏ó‡πå">‡∏≠‡∏≤‡∏ô‡∏ô‡∏ó‡πå</option>
                     <option value="‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå">‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå</option>
                </select>
            </div>
            <div class="form-group">
                <label for="filter-date">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</label>
                <input type="date" id="filter-date">
            </div>
        </div>
        <div class="records-grid" id="records-grid">
          </div>
      </div>

      <div class="tab-content" id="machine-history">
        <h2 style="margin-bottom:10px;">üîç ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á</h2>
        <div class="actions-row">
          <div class="form-group" style="min-width:260px; flex:1;">
            <label for="history-machine-select">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏¢‡πâ‡∏≠‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥:</label>
            <select id="history-machine-select"></select>
          </div>
          <button class="btn btn-danger" id="bulk-delete-btn">‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á</button>
          <button class="btn btn-secondary" id="export-excel-btn-1">‚¨áÔ∏è ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô Excel</button>
        </div>
        <div id="machine-details" style="display:none;">
          <div style="background:#e3f2fd; border-left:5px solid #2196f3; border-radius:14px; padding:16px; margin-bottom:14px;">
            <h3 id="selected-machine-name" style="color:#1976d2; margin-bottom:8px;"></h3>
            <div style="display:flex; gap:20px; flex-wrap:wrap;">
              <div><strong>‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ï‡∏£‡∏ô‡πâ‡∏≥:</strong> <span id="selected-machine-volume"></span> ‡∏•‡∏¥‡∏ï‡∏£</div>
              <div><strong>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö:</strong> <span id="selected-machine-count"></span> ‡∏Ñ‡∏£‡∏±‡πâ‡∏á</div>
              <div><strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î:</strong> <span id="selected-machine-status"></span></div>
            </div>
          </div>
          <canvas id="machineTrend" height="120" style="margin:10px 0 20px;"></canvas>
          <div style="overflow-x:auto;">
            <table class="summary-table" id="machine-history-table">
              <thead>
                <tr>
                  <th>‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà</th><th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≠‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö</th><th>‡∏ú‡∏•</th><th>‡∏ú‡∏π‡πâ‡∏™‡∏≠‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö</th><th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</th><th>‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</th><th>‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                </tr>
              </thead>
              <tbody id="machine-history-tbody"></tbody>
            </table>
          </div>
        </div>
        <div id="no-machine-selected" class="no-records">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏¢‡πâ‡∏≠‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö</div>
      </div>

      <div class="tab-content" id="summary">
        <h2 style="margin-bottom:10px;">üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏Å‡∏≤‡∏£‡∏™‡∏≠‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö</h2>
        <div class="actions-row">
          <button class="btn btn-secondary" id="export-excel-btn-2">‚¨áÔ∏è ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô Excel</button>
        </div>
        <div class="summary-stats">
          <div class="stat-card"><div class="stat-number stat-total" id="total-machines">0</div><div>‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏¢‡πâ‡∏≠‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div></div>
          <div class="stat-card"><div class="stat-number stat-pass" id="passed-machines">0</div><div>‡∏ú‡πà‡∏≤‡∏ô</div></div>
          <div class="stat-card"><div class="stat-number stat-fail" id="failed-machines">0</div><div>‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô</div></div>
          <div class="stat-card"><div class="stat-number stat-pending" id="pending-machines">0</div><div>‡∏£‡∏≠‡∏™‡∏≠‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö</div></div>
        </div>
        <div style="display:grid; grid-template-columns:1fr; gap:16px;">
          <canvas id="statusPie" height="120"></canvas>
          <canvas id="recordsByDay" height="140"></canvas>
        </div>
        <div style="margin-top:16px; overflow-x:auto;">
          <table class="summary-table" id="summary-table">
            <thead>
              <tr>
                <th>‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏¢‡πâ‡∏≠‡∏°</th><th>‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ï‡∏£ (‡∏•‡∏¥‡∏ï‡∏£)</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</th><th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</th><th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á</th>
              </tr>
            </thead>
            <tbody id="summary-tbody"></tbody>
          </table>
        </div>
      </div>
    </div>

    <div id="genericModal" class="modal">
      <div class="modal-content">
        <span class="close" id="genericModal-close">&times;</span>
        <h2 id="modal-title"></h2>
        <div id="modal-body"></div>
      </div>
    </div>

    <div id="alertModal" class="modal alert-modal">
        <div class="modal-content">
            <h2 id="alert-modal-title">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥</h2>
            <p id="alert-modal-body" class="alert-modal-body">‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?</p>
            <div class="alert-modal-footer">
                <button id="alert-modal-cancel" class="btn alert-btn-cancel">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button id="alert-modal-confirm" class="btn alert-btn-confirm">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
            </div>
        </div>
    </div>

  </div>

  <script src="app.js"></script>
</body>
</html>
